\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{beamerthemestrong}[2013/11/08 A strong theme for the Beamer class]

% Packages
\RequirePackage{tikz}
% Options
\def\@fontlato{lato}
\def\@fontraleway{raleway}
\edef\@mainfont{\@fontraleway}
\DeclareOption{lato}{\edef\@mainfont{\@fontlato}}
\DeclareOption{raleway}{\edef\@mainfont{\@fontraleway}}

\newif\if@usejafonts\@usejafontsfalse
\DeclareOption{ja}{\@usejafontstrue}

\DeclareOption*{\PackageWarning{beamerthemestrong}{Unknown option `\CurrentOption'}}

\ProcessOptions\relax


\newsavebox{\mybox}

% Lengths and Sizes
\setbeamersize{
  text margin left=8mm,
  text margin right=8mm}
\setlength{\leftmargini}{1em}
\setlength{\leftmarginii}{1em}
\setlength{\leftmarginiii}{1em}
\AtBeginDocument{%
    \setlength{\abovedisplayskip}{0pt}
    \setlength{\belowdisplayskip}{0pt}
    \setlength{\abovedisplayshortskip}{0pt}
    \setlength{\belowdisplayshortskip}{0pt}
}

% Basic colors chosen by using http://hue360.herokuapp.com/
\definecolor{mybg}{HTML}{FFFFFF}
\definecolor{myfg}{HTML}{333333}
\definecolor{mymain1}{HTML}{0086AB}
\definecolor{mymain2}{HTML}{42AAC7}
\definecolor{mymain3}{HTML}{97D3E3}
\definecolor{mymain4}{HTML}{C9E8F1}
\definecolor{myaccent1}{HTML}{EDAD0B}
\definecolor{myaccent2}{HTML}{F3C759}
\definecolor{myaccent3}{HTML}{F9E3AA}
\definecolor{myaccent4}{HTML}{FCF1D3}

\setbeamercolor{normal text}{fg=myfg}
\setbeamertemplate{background canvas}[default]
\setbeamercolor{background canvas}{bg=mybg}
\setbeamertemplate{navigation symbols}{}
\setbeamertemplate{footline}{%
  \leavevmode%
  \hbox{%
    \begin{beamercolorbox}[wd=\paperwidth,sep=2mm,right]{}%
      \usebeamercolor[fg]{page number in head/foot}\usebeamerfont{page number in head/foot}%
      \insertframenumber%
      \hspace*{1mm}%
    \end{beamercolorbox}%
  }%
  \vskip0pt%
}
\setbeamercolor{page number in head/foot}{fg=mymain3}
\setbeamerfont{page number in head/foot}{size=\footnotesize}
\setbeamerfont{title}{size=\LARGE,series=\bfseries}
\setbeamercolor{title}{fg=mymain1}
\setbeamertemplate{title page}{%
  \vskip0pt plus 4fill%
  {%
    \linespread{0.8}\usebeamerfont{title}\usebeamercolor[fg]{title}%
    \inserttitle\par%
    \ifx\insertsubtitle\empty%
    \else%
      \linespread{0.8}\usebeamerfont{subtitle}\usebeamercolor[fg]{subtitle}%
      \vskip0.5em%
      \insertsubtitle\par%
    \fi%
  }%
  \vskip4em
  {%
    \linespread{0.8}\selectfont%
    {\large\insertauthor\par}%
    \ifx\insertinstitute\empty%
    \else%
      \vskip0.5em%
      \linespread{0.8}\selectfont%
      {\footnotesize\insertinstitute\par}%
    \fi%
  }%
  \vskip1.5em%
  \insertdate\par%
  \vskip0pt plus 1fill%
}
\setbeamertemplate{frametitle}{%
  \vspace{1mm}%
  \tikz[scale=0.75]{
    \fill[fill=mymain1]   (0.00em, 0.00em) rectangle (0.45em, 0.45em);
    \fill[fill=myaccent1] (0.55em, 0.00em) rectangle (1.00em, 0.45em);
    \fill[fill=myaccent1] (0.00em, 0.55em) rectangle (0.45em, 1.00em);
    \fill[fill=mymain1]   (0.55em, 0.55em) rectangle (1.00em, 1.00em);
  }%
  \hspace{0.3em}%
  \insertframetitle%
  \par%
}
\setbeamerfont{frametitle}{size=\LARGE,series=\bfseries}
\setbeamercolor{frametitle}{fg=myfg}
\setbeamertemplate{section in toc}{\makebox[1em]{> }\inserttocsection\par}
\setbeamerfont{section in toc}{size=\large,series=\bfseries}
\setbeamercolor{section in toc}{fg=mymain1}
\setbeamertemplate{section in toc shaded}{\makebox[1em]{}\inserttocsection\par}
\setbeamerfont{section in toc shaded}{size=\large,series=\mdseries}
\setbeamercolor{section in toc shaded}{fg=myfg}
\setbeamercolor{item}{fg=mymain1}
\setbeamertemplate{itemize item}{\tiny\raise1.75pt\hbox{$\blacksquare$}}
\setbeamertemplate{itemize subitem}{\scriptsize\raise1.5pt\hbox{$\blacktriangleright$}}
\setbeamertemplate{itemize/enumerate body begin}{\bfseries\color{myfg}\renewcommand{\theenumii}{\theenumi\alph{enumii}}}
\setbeamertemplate{itemize/enumerate subbody begin}{\mdseries}
\setbeamerfont{enumerate item}{series=\bfseries}
\setbeamerfont{enumerate subitem}{series=\bfseries}
\setbeamerfont{description item}{series=\bfseries}
\setbeamertemplate{enumerate subitem}{\usebeamercolor[fg]{enumerate item}\usebeamerfont{enumerate item}\alph{enumii}.}
\setbeamerfont{alerted text}{series=\bfseries}
\setbeamercolor{alerted text}{fg=myaccent1}
% block
\setbeamerfont{block title}{series=\bfseries}
\setbeamercolor{block title}{fg=myfg}
\setbeamercolor{block body}{fg=myfg,bg=mybg!80!black}
\setbeamertemplate{block begin}{%
  \mbox\bgroup%
    \begin{beamercolorbox}[wd=\linewidth,sep=2mm]{block body}%
      {\usebeamercolor[fg]{block title}\usebeamerfont{block title}\insertblocktitle}%
      \ifthenelse{\equal{\insertblocktitle}{}}{}{\par}%
      \begin{minipage}{\linewidth - 2mm - 2mm}%
}
\setbeamertemplate{block end}{%
      \end{minipage}%
    \end{beamercolorbox}%
  \egroup%
}
% alert block
\setbeamerfont{block title alerted}{series=\bfseries}
\setbeamercolor{block title alerted}{fg=myfg}
\setbeamercolor{block body alerted}{fg=myfg,bg=myaccent2}
\setbeamertemplate{block alerted begin}{%
  \mbox\bgroup%
    \begin{beamercolorbox}[wd=\linewidth,sep=2mm]{block body alerted}%
      {\usebeamercolor[fg]{block title alerted}\usebeamerfont{block title alerted}\insertblocktitle}%
      \ifthenelse{\equal{\insertblocktitle}{}}{}{\par}%
      \begin{minipage}{\linewidth - 2mm - 2mm}%
}
\setbeamertemplate{block alerted end}{%
      \end{minipage}%
    \end{beamercolorbox}%
  \egroup%
}
% example block
\setbeamerfont{block title example}{series=\bfseries}
\setbeamercolor{block title example}{fg=myfg}
\setbeamercolor{block body example}{fg=myfg,bg=mymain3}
\setbeamertemplate{block example begin}{%
  \mbox\bgroup%
    \begin{beamercolorbox}[wd=\linewidth,sep=2mm]{block body example}%
      {\usebeamercolor[fg]{block title example}\usebeamerfont{block title example}\insertblocktitle}%
      \ifthenelse{\equal{\insertblocktitle}{}}{}{\par}%
      \begin{minipage}{\linewidth - 2mm - 2mm}%
}
\setbeamertemplate{block example end}{%
      \end{minipage}%
    \end{beamercolorbox}%
  \egroup%
}


% Font
% We use fontspec's 'main font' (serif font) for math and use the 'sans font'
% for normal text.
\usefonttheme[onlymath]{serif}
\RequirePackage{fontspec}
\setmainfont{TeX Gyre Pagella}  % serif font, used only for math
\ifx\@mainfont\@fontlato
  \setsansfont[Scale=MatchLowercase,
               Numbers={Proportional,Lining},
               BoldFont=Lato Black,
               ItalicFont=Lato Light Italic,
               BoldItalicFont=Lato Black Italic]
              {Lato Light}
\else\ifx\@mainfont\@fontraleway
  \setsansfont[Scale=MatchLowercase,
               Numbers={Proportional,Lining},
               BoldFont=Raleway ExtraBold,
               ItalicFont=Lato Light Italic,
               BoldItalicFont=Lato Black Italic]
              {Raleway Light}
\fi\fi
\setmonofont[Scale=MatchLowercase]{Inconsolata}

\if@usejafonts
  \RequirePackage{luatexja-fontspec}
  \setmainjfont[Scale=0.8,BoldFont=M+ 1c heavy]{M+ 1c light}
  \setsansjfont[Scale=0.8,BoldFont=M+ 1c heavy]{M+ 1c light}
\fi


% Highlighting
\RequirePackage{minted}
\usemintedstyle{pastie}
\newminted[html]{html}{bgcolor=black!5,fontsize=\footnotesize,gobble=4,linenos=false,numbersep=6pt}
